@page "/home"
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@attribute [Authorize]
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

<MudContainer Class="mt-4 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        <MudItem xs="12">
            @if (!string.IsNullOrEmpty(DisplayName))
            {
                <MudText Typo="Typo.h4" GutterBottom="true">Welcome, @DisplayName!</MudText>
            }
            else
            {
                <MudText Typo="Typo.h4" GutterBottom="true">Dashboard</MudText>
            }
            <MudText Class="mb-4">Your central hub for managing inventory and sales.</MudText>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <MudPaper Elevation="3" Class="pa-4 d-flex flex-column justify-space-between" Style="height: 180px;">
                <MudText Typo="Typo.h6">Total Products</MudText>
                <MudText Typo="Typo.h5">1,250</MudText>
                <MudIcon Icon="@Icons.Material.Outlined.Inventory2" Size="Size.Large" Color="Color.Primary" Class="align-self-end" />
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <MudPaper Elevation="3" Class="pa-4 d-flex flex-column justify-space-between" Style="height: 180px;">
                <MudText Typo="Typo.h6">Total Sales Orders</MudText>
                <MudText Typo="Typo.h5">580</MudText>
                <MudIcon Icon="@Icons.Material.Outlined.ShoppingCart" Size="Size.Large" Color="Color.Success" Class="align-self-end" />
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <MudPaper Elevation="3" Class="pa-4 d-flex flex-column justify-space-between" Style="height: 180px;">
                <MudText Typo="Typo.h6">Low Stock Items</MudText>
                <MudText Typo="Typo.h5">35</MudText>
                <MudIcon Icon="@Icons.Material.Outlined.Warning" Size="Size.Large" Color="Color.Warning" Class="align-self-end" />
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="8">
            <MudPaper Elevation="3" Class="pa-4" Style="height: 300px;">
                <MudText Typo="Typo.h6" GutterBottom="true">Recent Sales Activity</MudText>
                {/* Placeholder for a chart or recent sales list */}
                <MudText Typo="Typo.body2" Color="Color.Secondary">Displaying recent sales orders and their status.</MudText>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudPaper Elevation="3" Class="pa-4" Style="height: 300px;">
                <MudText Typo="Typo.h6" GutterBottom="true">Quick Actions</MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Class="mb-2 w-100" Href="/products/create">Add New Product</MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Success" Class="mb-2 w-100" Href="/sales/orders/create">Create Sales Order</MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Warning" Class="mb-2 w-100" Href="/inventory/stock-adjustments/create">Adjust Stock</MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Info" Class="w-100" Href="/purchase/orders/create">Create Purchase Order</MudButton>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="6">
            <MudPaper Elevation="3" Class="pa-4" Style="height: 250px;">
                <MudText Typo="Typo.h6" GutterBottom="true">Inventory Overview</MudText>
                {/* Placeholder for an inventory status chart or summary */}
                <MudText Typo="Typo.body2" Color="Color.Secondary">Visual representation of your current stock levels.</MudText>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="6">
            <MudPaper Elevation="3" Class="pa-4" Style="height: 250px;">
                <MudText Typo="Typo.h6" GutterBottom="true">Latest Orders</MudText>
                {/* Placeholder for a list of the latest sales or purchase orders */}
                <MudText Typo="Typo.body2" Color="Color.Secondary">A summary of your most recent transactions.</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private string? DisplayName { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity?.IsAuthenticated == true)
        {
            DisplayName = user.FindFirstValue(ClaimTypes.Name);
            if (string.IsNullOrEmpty(DisplayName))
            {
                DisplayName = user.FindFirstValue(ClaimTypes.Email);
            }
        }
    }
}