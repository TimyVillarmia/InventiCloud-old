@implements IDisposable
@using Microsoft.AspNetCore.Authorization

@inject NavigationManager NavigationManager

<MudNavMenu>
    <MudNavLink Href="/home" Match="NavLinkMatch.All" Icon="@Icons.Material.Outlined.Home">Home</MudNavLink>

    <MudNavGroup Title="Products" Expanded="true" Icon="@Icons.Material.Outlined.Inventory2">
        <MudNavLink Href="products" Match="NavLinkMatch.Prefix">Product List</MudNavLink>
        <MudNavLink Href="product-setup/categories" Match="NavLinkMatch.Prefix">Categories</MudNavLink>
    </MudNavGroup>

    <MudNavGroup Title="Inventory" Expanded="true" Icon="@Icons.Material.Outlined.Warehouse">
        <MudNavLink Href="inventory/stock-levels" Match="NavLinkMatch.Prefix">Stock Levels</MudNavLink>
        <MudNavGroup Title="Stock Transfers" Expanded="true">
            <MudNavLink Href="inventory/stock-transfers/create" Match="NavLinkMatch.Prefix">Create Transfer</MudNavLink>
            <MudNavLink Href="inventory/stock-transfers/requested" Match="NavLinkMatch.Prefix">My Requests</MudNavLink>
            <MudNavLink Href="inventory/stock-transfers/approvals" Match="NavLinkMatch.Prefix">Awaiting Approval</MudNavLink>
        </MudNavGroup>
        <MudNavLink Href="inventory/stock-adjustments" Match="NavLinkMatch.Prefix">Stock Adjustments</MudNavLink>
    </MudNavGroup>

    <MudNavGroup Title="Purchases" Expanded="true" Icon="@Icons.Material.Outlined.LocalShipping">
        <MudNavLink Href="purchase/orders" Match="NavLinkMatch.Prefix">Purchase Orders</MudNavLink>
        <MudNavLink Href="purchase/suppliers" Match="NavLinkMatch.Prefix">Suppliers</MudNavLink>
    </MudNavGroup>

    <MudNavGroup Title="Sales" Expanded="true" Icon="@Icons.Material.Outlined.ShoppingCart">
        <MudNavLink Href="sales/orders" Match="NavLinkMatch.Prefix">Sales Orders</MudNavLink>
        <MudNavLink Href="sales/customers" Match="NavLinkMatch.Prefix">Customers</MudNavLink>
    </MudNavGroup>
    <AuthorizeView Roles="Administrator">
        <MudNavGroup Title="Store" Expanded="true" Icon="@Icons.Material.Outlined.Storefront">
            <MudNavLink Href="store/branches" Match="NavLinkMatch.Prefix">Branches</MudNavLink>
            <MudNavLink Href="store/sales-persons" Match="NavLinkMatch.Prefix">Sales Person</MudNavLink>
        </MudNavGroup>
    </AuthorizeView>
    

    <MudNavLink Href="/analytics" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.BarChart">Analytics</MudNavLink>

    <MudText Typo="Typo.body2" Class="px-4 mud-text-secondary">Settings</MudText>
    <MudNavLink Href="/account" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.AccountCircle">Account</MudNavLink>
    <MudDivider Class="my-2" />
    <MudNavLink Icon="@Icons.Material.Outlined.Logout" IconColor="Color.Error" Class="red-text" OnClick="Logout">Logout</MudNavLink>

</MudNavMenu>



@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    private async Task Logout()
    {

        NavigationManager.NavigateTo("/Account/Logout", true); // Assuming you have an Account/Logout endpoint
    }
  

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}


